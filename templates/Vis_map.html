<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>KBO êµ¬ì¥ ì§€ë„</title>
  <style>
    /* ---- í˜ì´ì§€ ê³µí†µ ---- */
    body { background: #f5f6fa; font-family: 'Noto Sans KR', sans-serif; margin: 0; }

    /* ---- ìƒë‹¨ ë°°ë„ˆ(ì§€ë„ëŠ” ê±´ë“œë¦¬ì§€ ì•ŠìŒ) ---- */
    .header {
      background: transparent;           /* ìƒë‹¨ ì „ì²´ ë°°ê²½ ì œê±° */
      padding: 24px 16px 8px;            /* ë°”ê¹¥ ì—¬ë°± */
    }
    .top-banner {
      max-width: 880px;
      margin: 0 auto;
      background: #ffffff;
      border: 1px solid #e9eef5;
      border-radius: 16px;
      box-shadow: 0 6px 16px rgba(16, 24, 40, 0.06);
      padding: 16px 18px;
      display: flex;
      align-items: center;
      gap: 16px;
    }
    .banner-title {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 4px;
      min-width: 0;
    }
    .banner-title h1 {
      font-size: 18px;
      font-weight: 700;
      color: #1f2937;
      margin: 0;
    }
    .banner-title p {
      font-size: 13px;
      color: #6b7280;
      margin: 0;
    }
    .banner-actions {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .banner-label {
      font-size: 13px;
      color: #374151;
      font-weight: 600;
    }
    .banner-select {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      padding: 8px 12px;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      font-weight: 600;
      font-size: 14px;
      color: #1f2937;
      background: #ffffff;
      box-shadow: 0 1px 0 rgba(0,0,0,0.02) inset;
      transition: border-color .2s, box-shadow .2s;
    }
    .banner-select:focus {
      outline: none;
      border-color: #1a73e8;
      box-shadow: 0 0 0 4px rgba(26,115,232,0.12);
    }

    /* ---- ì§€ë„(ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€) ---- */
    .map-container { position: relative; width: 800px; height: 1000px; margin: 40px auto; }
    .korea-map { width: 100%; border-radius: 12px; box-shadow: 0 0 10px rgba(0,0,0,0.15); display: block; }

    /* ---- ë§ˆì»¤(ê¸°ì¡´ í†¤ ìœ ì§€) ---- */
    .team-marker {
      position: absolute;
      min-width: 40px;
      background: white;
      border: 2px solid #1a73e8;
      border-radius: 10px;
      font-size: 13px;
      padding: 4px 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      text-align: center;
      transform: translate(-50%, -50%);
      white-space: nowrap;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: bold;
      z-index: 2;
    }
    .team-marker:hover { background: #1a73e8; color: white; transform: translate(-50%, -50%) scale(1.1); }

    .footer { text-align: center; padding: 20px; color: #666; }
  </style>
</head>
<body>
  <!-- ìƒë‹¨ ë°°ë„ˆë§Œ ì¹´ë“œí˜•ìœ¼ë¡œ ë³€ê²½ -->
  <div class="header">
    <div class="top-banner">
      <div class="banner-title">
        <h1>KBO êµ¬ì¥ ì§€ë„</h1>
        <p>êµ¬ì¥ì„ í´ë¦­í•˜ì—¬ ì…ì¥í•˜ì„¸ìš”</p>
      </div>

      <!-- ì„œë²„ì—ì„œ ì „ë‹¬ëœ selected_team (ë³´ì´ì§€ ì•ŠìŒ) -->
      <div id="server-data" data-selected-team="{{ selected_team|default('') }}" style="display:none;"></div>

      <div class="banner-actions">
        <label for="team-select" class="banner-label">íŒ€ ì„ íƒ</label>
        <select id="team-select" class="banner-select"></select>
      </div>
    </div>
  </div>

  <!-- ì§€ë„ ì˜ì—­ì€ ê·¸ëŒ€ë¡œ ìœ ì§€ -->
  <div class="map-container">
    <img src="static/kr.svg" alt="Korea Map" class="korea-map" />
    <div id="markers"></div>
  </div>

  <div class="footer">
    <p>ğŸ“Š ì‹¤ì‹œê°„ KBO ë°ì´í„°ì™€ í•¨ê»˜ ì•¼êµ¬ì¥ì„ ì²´í—˜í•´ë³´ì„¸ìš”!</p>
  </div>

  <script>
    // ì„œë²„ ì£¼ì…ê°’ / URL / localStorage ìš°ì„ ìˆœìœ„
    const serverEl = document.getElementById('server-data');
    const serverTeam = serverEl && serverEl.dataset.selectedTeam ? serverEl.dataset.selectedTeam : '';
    const urlTeam = (new URLSearchParams(window.location.search)).get('team') || '';
    let selectedTeam = serverTeam || urlTeam || localStorage.getItem('kbo_selected_team') || null;

    // ê³µë°±/ë³´ì´ì§€ ì•ŠëŠ” ë¬¸ì ì •ë¦¬
    const INVIS_RE = /[\s\u00A0\u200B-\u200D\u202F\uFEFF]+/g;
    const clean = s => (s || '').toString().replace(INVIS_RE, '');

    // í‘œì‹œëª… â†’ ì •ì‹ êµ¬ì¥ëª…
    const STADIUM_ALIASES = {
      "ì ì‹¤": "ì ì‹¤",
      "ê³ ì²™": "ê³ ì²™",
      "ë¬¸í•™": "ë¬¸í•™",
      "ìˆ˜ì›": "ìˆ˜ì›",
      "ëŒ€ì „": "ëŒ€ì „",
      "ëŒ€êµ¬": "ëŒ€êµ¬",
      "ê´‘ì£¼": "ê´‘ì£¼",
      "ì°½ì›": "ì°½ì›",
      "ìš¸ì‚°": "ìš¸ì‚°",
      "ì‚¬ì§": "ì‚¬ì§",
      "í¬í•­": "í¬í•­"
    };

    function populateTeams() {
      fetch('/api/teams').then(r => r.json()).then(list => {
        const sel = document.getElementById('team-select');
        sel.innerHTML = '';
        list.forEach((t) => {
          const opt = document.createElement('option');
          opt.value = t; opt.text = t;
          sel.appendChild(opt);
        });

        if (!selectedTeam) selectedTeam = sel.options.length ? sel.options[0].value : 'LG';

        // ë“œë¡­ë‹¤ìš´ ì„ íƒ ë°˜ì˜
        for (let i = 0; i < sel.options.length; i++) {
          if (sel.options[i].value === selectedTeam) { sel.selectedIndex = i; break; }
        }

        sel.addEventListener('change', function () {
          selectedTeam = this.value;
          try { localStorage.setItem('kbo_selected_team', selectedTeam); } catch (e) {}
        });

        // íŒ€ ëª©ë¡ ì¤€ë¹„ í›„ ë§ˆì»¤ ìƒì„±
        createMarkers();
      }).catch(() => {
        // ì‹¤íŒ¨ ì‹œ ìµœì†Œê°’ ë³´ì¥
        const sel = document.getElementById('team-select');
        if (sel && sel.options.length === 0) {
          const opt = document.createElement('option');
          opt.value = 'LG'; opt.text = 'LG'; sel.appendChild(opt);
          selectedTeam = 'LG';
        }
        createMarkers();
      });
    }

    function createMarkers() {
      const markersContainer = document.getElementById("markers");
      markersContainer.innerHTML = ''; // ì¤‘ë³µ ë°©ì§€

      // âœ… ì ì‹¤: ê¸°ì¡´ 140px, 165pxì˜ ì¤‘ê°„ê°’(â‰ˆ152.5) â†’ 153pxë¡œ í†µì¼í•´ ë‹¨ì¼ ë§ˆì»¤
      const stadiums = [
        { name: "ì ì‹¤", team: "LG/ë‘ì‚°", top: 153, left: 340 },   // í•˜ë‚˜ë¡œ í•©ì¹¨ (ì¤‘ì•™ ìœ„ì¹˜)
        { name: "ê³ ì²™", team: "í‚¤ì›€", top: 180, left: 310 },
        { name: "ë¬¸í•™", team: "SSG",  top: 200, left: 280 },
        { name: "ìˆ˜ì›", team: "KT",   top: 225, left: 320 },
        { name: "ëŒ€ì „", team: "í•œí™”", top: 350, left: 390 },
        { name: "ëŒ€êµ¬", team: "ì‚¼ì„±", top: 420, left: 490 },
        { name: "ê´‘ì£¼", team: "KIA",  top: 510, left: 300 },
        { name: "ì°½ì›", team: "NC",   top: 500, left: 480 },
        { name: "ìš¸ì‚°", team: "NC",   top: 520, left: 470 },
        { name: "ì‚¬ì§", team: "ë¡¯ë°", top: 510, left: 540 },
        { name: "í¬í•­", team: "ì‚¼ì„±", top: 430, left: 520 }
      ];

      const getCurrentTeam = () => document.getElementById('team-select').value || 'LG';

      stadiums.forEach(s => {
        const marker = document.createElement("div");
        marker.className = "team-marker";
        marker.style.top = `${s.top}px`;
        marker.style.left = `${s.left}px`;
        marker.innerText = s.name;

        marker.addEventListener('click', () => {
          const team = clean(getCurrentTeam() || s.team);
          const display = clean(s.name);
          const canonical = clean(STADIUM_ALIASES[display] || display);
          const url = `/stadium/${encodeURIComponent(canonical)}/chart?team=${encodeURIComponent(team)}`;
          window.location.href = url;
        });

        markersContainer.appendChild(marker);
      });
    }

    // ì´ˆê¸°í™”
    populateTeams();
  </script>
</body>
</html>
