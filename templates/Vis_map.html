#Vis_map.html

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>KBO êµ¬ì¥ ì§€ë„</title>
  <style>
    body { background: #f3f4f6; font-family: 'Noto Sans KR', sans-serif; margin: 0; }
    .header { text-align: center; padding: 20px; background: linear-gradient(135deg, #1a73e8, #34a853); color: white; }
    .map-container { position: relative; width: 800px; height: 1000px; margin: 40px auto; }
    .korea-map { width: 100%; border-radius: 12px; box-shadow: 0 0 10px rgba(0,0,0,0.15); display: block; }
    .team-marker { position: absolute; min-width: 40px; background: white; border: 2px solid #1a73e8; border-radius: 10px;
      font-size: 13px; padding: 4px 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.2); text-align: center; transform: translate(-50%, -50%);
      white-space: nowrap; cursor: pointer; transition: all 0.3s ease; font-weight: bold; z-index: 2; }
    .team-marker:hover { background: #1a73e8; color: white; transform: translate(-50%, -50%) scale(1.1); }
    .footer { text-align: center; padding: 20px; color: #666; }
  </style>
</head>
<body>
  <div class="header">
    <h1>ğŸŸï¸ KBO êµ¬ì¥ ì§€ë„</h1>
    <p>êµ¬ì¥ì„ í´ë¦­í•˜ì—¬ ì…ì¥í•˜ì„¸ìš”!</p>
  
    <!-- ì„œë²„ì—ì„œ ì „ë‹¬ëœ selected_teamì„ ì•ˆì „í•˜ê²Œ ì£¼ì…(ë³´ì´ì§€ ì•ŠìŒ) -->
    <div id="server-data" data-selected-team="{{ selected_team|default('') }}" style="display:none;"></div>
  
    <div style="margin-top:10px;">
      <label for="team-select" style="color:white; font-weight:bold; margin-right:8px;">íŒ€ ì„ íƒ:</label>
      <select id="team-select" style="padding:6px 10px; border-radius:6px; font-weight:bold;"></select>
    </div>
  </div>
  
  <div class="map-container">
    <img src="kr.svg" alt="Korea Map" class="korea-map" />
    <div id="markers"></div>
  </div>

  <div class="footer">
    <p>ğŸ“Š ì‹¤ì‹œê°„ KBO ë°ì´í„°ì™€ í•¨ê»˜ ì•¼êµ¬ì¥ì„ ì²´í—˜í•´ë³´ì„¸ìš”!</p>
  </div>

  <script>
  // ì„œë²„ ì£¼ì…ê°’ (data-attribute), URL ì¿¼ë¦¬, localStorageë¥¼ ìš°ì„ ìˆœìœ„ë¡œ ì‚¬ìš©
  const serverEl = document.getElementById('server-data');
  const serverTeam = serverEl && serverEl.dataset.selectedTeam ? serverEl.dataset.selectedTeam : '';
  const urlTeam = (new URLSearchParams(window.location.search)).get('team') || '';
  let selectedTeam = serverTeam || urlTeam || localStorage.getItem('kbo_selected_team') || null;

  // âœ… ì•ë‹¨ì—ì„œë„ ê³µë°±/ë³´ì´ì§€ ì•ŠëŠ” ë¬¸ì ì •ë¦¬(ë°±ì—”ë“œì™€ ë™ì¼ ì·¨ì§€)
  const INVIS_RE = /[\s\u00A0\u200B-\u200D\u202F\uFEFF]+/g;
  const clean = s => (s || '').toString().replace(INVIS_RE, '');

  // âœ… í‘œì‹œëª… â†’ CSV ì •ì‹ êµ¬ì¥ëª… ë§¤í•‘(í•„ìš”ì‹œ ì¶”ê°€)
  const STADIUM_ALIASES = {
    "ì ì‹¤": "ì ì‹¤",
    "ê³ ì²™": "ê³ ì²™",
    "ë¬¸í•™": "ë¬¸í•™",
    "ìˆ˜ì›": "ìˆ˜ì›",
    "ëŒ€ì „": "ëŒ€ì „",
    "ëŒ€êµ¬": "ëŒ€êµ¬",
    "ê´‘ì£¼": "ê´‘ì£¼",
    "ì°½ì›": "ì°½ì›",
    "ìš¸ì‚°": "ìš¸ì‚°",
    "ì‚¬ì§": "ì‚¬ì§",
    "í¬í•­": "í¬í•­"
  };

  function populateTeams() {
    fetch('/api/teams').then(r=>r.json()).then(list=>{
      const sel = document.getElementById('team-select');
      sel.innerHTML = '';
      list.forEach((t)=>{
        const opt = document.createElement('option');
        opt.value = t; opt.text = t;
        sel.appendChild(opt);
      });

      if (!selectedTeam) selectedTeam = sel.options.length ? sel.options[0].value : 'LG';

      // ë“œë¡­ë‹¤ìš´ì— ì„ íƒ ë°˜ì˜
      for (let i=0;i<sel.options.length;i++){
        if (sel.options[i].value === selectedTeam) { sel.selectedIndex = i; break; }
      }

      sel.addEventListener('change', function(){
        selectedTeam = this.value;
        try { localStorage.setItem('kbo_selected_team', selectedTeam); } catch(e){}
      });

      // íŒ€ ëª©ë¡ ì¤€ë¹„ê°€ ëë‚˜ë©´ ë§ˆì»¤ ìƒì„±(íƒ€ì´ë° ë¬¸ì œ ë°©ì§€)
      createMarkers();
    }).catch(e=>{
      const sel = document.getElementById('team-select');
      if(sel && sel.options.length===0){
        const opt = document.createElement('option');
        opt.value = 'LG'; opt.text = 'LG'; sel.appendChild(opt);
        selectedTeam = 'LG';
      }
      createMarkers();
    });
  }

  // ë§ˆì»¤ ìƒì„±: í´ë¦­ ì‹œ 'í˜„ì¬ ë“œë¡­ë‹¤ìš´ ê°’' ì‚¬ìš© + ì •ì‹ êµ¬ì¥ëª…ìœ¼ë¡œ ë¼ìš°íŒ…
  function createMarkers(){
    const stadiums = [
      { name: "ì ì‹¤", team: "LG",   top: 140, left: 340 },
      { name: "ì ì‹¤", team: "ë‘ì‚°", top: 165, left: 340 },
      { name: "ê³ ì²™", team: "í‚¤ì›€", top: 180, left: 310 },
      { name: "ë¬¸í•™", team: "SSG",  top: 200, left: 280 },
      { name: "ìˆ˜ì›", team: "KT",   top: 225, left: 320 },
      { name: "ëŒ€ì „", team: "í•œí™”", top: 350, left: 390 },
      { name: "ëŒ€êµ¬", team: "ì‚¼ì„±", top: 420, left: 490 },
      { name: "ê´‘ì£¼", team: "KIA",  top: 510, left: 300 },
      { name: "ì°½ì›", team: "NC",   top: 500, left: 480 },
      { name: "ìš¸ì‚°", team: "NC",   top: 520, left: 470 },
      { name: "ì‚¬ì§", team: "ë¡¯ë°", top: 510, left: 540 },
      { name: "í¬í•­", team: "ì‚¼ì„±", top: 430, left: 520 }
    ];

    const markersContainer = document.getElementById("markers");
    markersContainer.innerHTML = ''; // ì¤‘ë³µ ë°©ì§€
    const getCurrentTeam = () => document.getElementById('team-select').value || 'LG';

    stadiums.forEach(s => {
      const marker = document.createElement("div");
      marker.className = "team-marker";
      marker.style.top = `${s.top}px`;
      marker.style.left = `${s.left}px`;
      marker.innerText = s.name;

      marker.addEventListener('click', () => {
        // ë“œë¡­ë‹¤ìš´ì´ ë¹„ì–´ìˆìœ¼ë©´ ë§ˆì»¤ì˜ teamì„ ì‚¬ìš©
        const team = clean(getCurrentTeam() || s.team);
        const display = clean(s.name);
        const canonical = clean(STADIUM_ALIASES[display] || display); // ì•½ì¹­ ì „ì†¡
        const url = `/stadium/${encodeURIComponent(canonical)}/chart?team=${encodeURIComponent(team)}`;
        console.debug("navigating to:", {display, canonical, team, url});
        window.location.href = url;
      });

      markersContainer.appendChild(marker);
    });
  }

  // ì´ˆê¸°í™”
  populateTeams();
</script>
</body>
</html>
